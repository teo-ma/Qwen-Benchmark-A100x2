#!/bin/bash
python3 - <<'EOF'
import base64, pathlib
DATA = '''IyEvdXNyL2Jpbi9lbnYgcHl0aG9uMwoiIiJVbmlmaWVkIFF3ZW4gYmVuY2htYXJrIHJ1bm5lciB3aXRoIG9wdGlvbmFsIE5WTWUgb2ZmbG9hZCBoZWxwZXJzLiIiIgoKZnJvbSBfX2Z1dHVyZV9fIGltcG9ydCBhbm5vdGF0aW9ucwoKaW1wb3J0IGFyZ3BhcnNlCmltcG9ydCBqc29uCmltcG9ydCBtYXRoCmltcG9ydCBvcwppbXBvcnQgdGltZQpmcm9tIHR5cGluZyBpbXBvcnQgRGljdCwgTGlzdCwgT3B0aW9uYWwsIFR1cGxlLCBVbmlvbgoKaW1wb3J0IHRvcmNoCmZyb20gdHJhbnNmb3JtZXJzIGltcG9ydCBBdXRvTW9kZWxGb3JDYXVzYWxMTSwgQXV0b1Rva2VuaXplciAgIyB0eXBlOiBpZ25vcmUKCnRyeTogICMgYml0c2FuZGJ5dGVzIGlzIG9wdGlvbmFsIG91dHNpZGUgSU5UOCBydW5zCiAgICBmcm9tIHRyYW5zZm9ybWVycyBpbXBvcnQgQml0c0FuZEJ5dGVzQ29uZmlnICAjIHR5cGU6IGlnbm9yZQpleGNlcHQgSW1wb3J0RXJyb3I6ICAjIHByYWdtYTogbm8gY292ZXIgLSBkZXBlbmRlbmN5IG9wdGlvbmFsIG9uIEZQMTYtb25seSBob3N0cwogICAgQml0c0FuZEJ5dGVzQ29uZmlnID0gTm9uZQoKdHJ5OiAgIyB2TExNIGlzIG9wdGlvbmFsIGZvciB0ZW5zb3IgcGFyYWxsZWwgcnVucwogICAgZnJvbSB2bGxtIGltcG9ydCBMTE0sIFNhbXBsaW5nUGFyYW1zICAjIHR5cGU6IGlnbm9yZQpleGNlcHQgSW1wb3J0RXJyb3I6ICAjIHByYWdtYTogbm8gY292ZXIgLSB2TExNIG9ubHkgbmVlZGVkIHdoZW4gZW5naW5lPXZsbG0KICAgIExMTSA9IE5vbmUKICAgIFNhbXBsaW5nUGFyYW1zID0gTm9uZQoKdHJ5OiAgIyBMTURlcGxveSBpcyBvcHRpb25hbCB1bmxlc3MgVHVyYm9NaW5kIGJlbmNobWFya2luZyBpcyByZXF1ZXN0ZWQKICAgIGZyb20gbG1kZXBsb3kgaW1wb3J0IHBpcGVsaW5lIGFzIGxtZGVwbG95X3BpcGVsaW5lICAjIHR5cGU6IGlnbm9yZQogICAgZnJvbSBsbWRlcGxveSBpbXBvcnQgVHVyYm9taW5kRW5naW5lQ29uZmlnICAjIHR5cGU6IGlnbm9yZQpleGNlcHQgSW1wb3J0RXJyb3I6ICAjIHByYWdtYTogbm8gY292ZXIgLSBMTURlcGxveSBvbmx5IG5lZWRlZCBmb3IgVHVyYm9NaW5kIHJ1bnMKICAgIGxtZGVwbG95X3BpcGVsaW5lID0gTm9uZQogICAgVHVyYm9taW5kRW5naW5lQ29uZmlnID0gTm9uZQoKQkFTRV9QUk9NUFQgPSAoCiAgICAiVW5pZmllZCBRd2VuIGJlbmNobWFyayBwYXlsb2FkIG1peGluZyBFbmdsaXNoLCDkuK3mlocsIGFuZCBzdHJ1Y3R1cmVkIHN0ZXBzLiAiCiAgICAiV2Ugc3RyZXNzIHRva2VuaXplciB2YXJpZXR5IHdpdGggbWV0cmljcywgQVBJcywgYW5kIGNvbXBsaWFuY2UgdGV4dC4gIgogICAgIuWGjeWkmuWGmeS4gOS6m+maj+acuueahOivjeivreadpeWinuWKoOWkjeadguW6pi4iCikKCgpkZWYgcHJlcGFyZV9wcm9tcHRfdG9rZW5zKHRva2VuaXplcjogQXV0b1Rva2VuaXplciwgdGFyZ2V0X3Rva2VuczogaW50KSAtPiBUdXBsZVt0b3JjaC5UZW5zb3IsIHRvcmNoLlRlbnNvcl06CiAgICBiYXNlX3Rva2VucyA9IHRva2VuaXplcihCQVNFX1BST01QVCwgcmV0dXJuX3RlbnNvcnM9InB0IiwgYWRkX3NwZWNpYWxfdG9rZW5zPUZhbHNlKVsiaW5wdXRfaWRzIl1bMF0KICAgIGlmIGJhc2VfdG9rZW5zLm5lbGVtZW50KCkgPT0gMDoKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCJQcm9tcHQgdG9rZW5pemVyIHJldHVybmVkIHplcm8gdG9rZW5zIikKICAgIHJlcGVhdHMgPSBtYXRoLmNlaWwoKHRhcmdldF90b2tlbnMgKyBsZW4oYmFzZV90b2tlbnMpIC0gMSkgLyBsZW4oYmFzZV90b2tlbnMpKQogICAgZXhwYW5kZWQgPSBiYXNlX3Rva2Vucy5yZXBlYXQocmVwZWF0cylbOnRhcmdldF90b2tlbnNdCiAgICBpbnB1dF9pZHMgPSBleHBhbmRlZC51bnNxdWVlemUoMCkKICAgIGF0dGVudGlvbl9tYXNrID0gdG9yY2gub25lc19saWtlKGlucHV0X2lkcykKICAgIHJldHVybiBpbnB1dF9pZHMsIGF0dGVudGlvbl9tYXNrCgoKZGVmIHN5bmNfY3VkYSgpIC0+IE5vbmU6CiAgICBpZiB0b3JjaC5jdWRhLmlzX2F2YWlsYWJsZSgpOgogICAgICAgIHRvcmNoLmN1ZGEuc3luY2hyb25pemUoKQoKCmRlZiBjb2xsZWN0X3BlYWtfbWVtb3J5KCkgLT4gRGljdFtzdHIsIGZsb2F0XToKICAgIHBlYWtzOiBEaWN0W3N0ciwgZmxvYXRdID0ge30KICAgIGlmIHRvcmNoLmN1ZGEuaXNfYXZhaWxhYmxlKCk6CiAgICAgICAgZm9yIGlkeCBpbiByYW5nZSh0b3JjaC5jdWRhLmRldmljZV9jb3VudCgpKToKICAgICAgICAgICAgYnl0ZXNfdXNlZCA9IHRvcmNoLmN1ZGEubWF4X21lbW9yeV9hbGxvY2F0ZWQoaWR4KQogICAgICAgICAgICBwZWFrc1tmImN1ZGE6e2lkeH0iXSA9IHJvdW5kKGJ5dGVzX3VzZWQgLyAoMTAyNCAqKiAzKSwgMikKICAgIHJldHVybiBwZWFrcwoKCmRlZiBidWlsZF9tYXhfbWVtb3J5KGxpbWl0X2dpYjogT3B0aW9uYWxbZmxvYXRdKSAtPiBPcHRpb25hbFtEaWN0W1VuaW9uW2ludCwgc3RyXSwgc3RyXV06CiAgICBpZiBsaW1pdF9naWIgaXMgTm9uZSBvciBub3QgdG9yY2guY3VkYS5pc19hdmFpbGFibGUoKToKICAgICAgICByZXR1cm4gTm9uZQogICAgcGVyX2RldmljZSA9IGYie2xpbWl0X2dpYn1HaUIiCiAgICBsYXlvdXQ6IERpY3RbVW5pb25baW50LCBzdHJdLCBzdHJdID0ge2lkeDogcGVyX2RldmljZSBmb3IgaWR4IGluIHJhbmdlKHRvcmNoLmN1ZGEuZGV2aWNlX2NvdW50KCkpfQogICAgIyBBbHNvIGFkdmVydGlzZSBhIGdlbmVyb3VzIENQVSBidWRnZXQgc28gYWNjZWxlcmF0ZSBoYXMgcm9vbSB0byBzcGlsbCB0ZW5zb3JzLgogICAgbGF5b3V0WyJjcHUiXSA9ICI1MTJHaUIiCiAgICByZXR1cm4gbGF5b3V0CgoKZGVmIHJ1bl9iZW5jaG1hcmsoCiAgICBtb2RlbF9pZDogc3RyLAogICAgcHJlY2lzaW9uOiBzdHIsCiAgICBwcm9tcHRfdG9rZW5zOiBpbnQsCiAgICBnZW5fdG9rZW5zOiBpbnQsCiAgICBkZXZpY2VfbWFwOiBzdHIsCiAgICBtYXhfbWVtb3J5X2dpYjogT3B0aW9uYWxbZmxvYXRdLAogICAgb2ZmbG9hZF9mb2xkZXI6IE9wdGlvbmFsW3N0cl0sCiAgICBvZmZsb2FkX3N0YXRlX2RpY3Q6IGJvb2wsCiAgICBvZmZsb2FkX2J1ZmZlcnM6IGJvb2wsCiAgICBsb3dfY3B1X21lbV91c2FnZTogYm9vbCwKICAgIGVuZ2luZTogc3RyLAogICAgdGVuc29yX3BhcmFsbGVsX3NpemU6IGludCwKICAgIGF0dG5faW1wbDogc3RyLAogICAgbWF4X21vZGVsX2xlbjogT3B0aW9uYWxbaW50XSwKICAgIGdwdV9tZW1vcnlfdXRpbGl6YXRpb246IGZsb2F0LAogICAgbG1kZXBsb3lfbW9kZWxfcGF0aDogT3B0aW9uYWxbc3RyXSwKKSAtPiBEaWN0W3N0ciwgb2JqZWN0XToKICAgIHRva2VuaXplciA9IEF1dG9Ub2tlbml6ZXIuZnJvbV9wcmV0cmFpbmVkKG1vZGVsX2lkLCB0cnVzdF9yZW1vdGVfY29kZT1UcnVlKQogICAgaWYgdG9rZW5pemVyLnBhZF90b2tlbiBpcyBOb25lOgogICAgICAgIHRva2VuaXplci5wYWRfdG9rZW4gPSB0b2tlbml6ZXIuZW9zX3Rva2VuCgogICAgaW5wdXRfaWRzLCBhdHRlbnRpb25fbWFzayA9IHByZXBhcmVfcHJvbXB0X3Rva2Vucyh0b2tlbml6ZXIsIHByb21wdF90b2tlbnMpCgogICAgaWYgZW5naW5lID09ICJoZiI6CiAgICAgICAgbW9kZWxfa3dhcmdzOiBEaWN0W3N0ciwgb2JqZWN0XSA9IHsKICAgICAgICAgICAgImRldmljZV9tYXAiOiBkZXZpY2VfbWFwLAogICAgICAgICAgICAidHJ1c3RfcmVtb3RlX2NvZGUiOiBUcnVlLAogICAgICAgIH0KCiAgICAgICAgbWF4X21lbW9yeSA9IGJ1aWxkX21heF9tZW1vcnkobWF4X21lbW9yeV9naWIpCiAgICAgICAgaWYgbWF4X21lbW9yeToKICAgICAgICAgICAgbW9kZWxfa3dhcmdzWyJtYXhfbWVtb3J5Il0gPSBtYXhfbWVtb3J5CgogICAgICAgIGlmIG9mZmxvYWRfZm9sZGVyOgogICAgICAgICAgICBtb2RlbF9rd2FyZ3NbIm9mZmxvYWRfZm9sZGVyIl0gPSBvZmZsb2FkX2ZvbGRlcgogICAgICAgIGlmIG9mZmxvYWRfc3RhdGVfZGljdDoKICAgICAgICAgICAgbW9kZWxfa3dhcmdzWyJvZmZsb2FkX3N0YXRlX2RpY3QiXSA9IFRydWUKICAgICAgICBpZiBvZmZsb2FkX2J1ZmZlcnM6CiAgICAgICAgICAgIG1vZGVsX2t3YXJnc1sib2ZmbG9hZF9idWZmZXJzIl0gPSBUcnVlCiAgICAgICAgaWYgbG93X2NwdV9tZW1fdXNhZ2U6CiAgICAgICAgICAgIG1vZGVsX2t3YXJnc1sibG93X2NwdV9tZW1fdXNhZ2UiXSA9IFRydWUKICAgICAgICBpZiBhdHRuX2ltcGwgIT0gImF1dG8iOgogICAgICAgICAgICBtb2RlbF9rd2FyZ3NbImF0dG5faW1wbGVtZW50YXRpb24iXSA9IGF0dG5faW1wbAoKICAgICAgICBpZiBwcmVjaXNpb24ubG93ZXIoKSA9PSAiZnAxNiI6CiAgICAgICAgICAgIG1vZGVsX2t3YXJnc1sidG9yY2hfZHR5cGUiXSA9IHRvcmNoLmZsb2F0MTYKICAgICAgICBlbGlmIHByZWNpc2lvbi5sb3dlcigpID09ICJpbnQ4IjoKICAgICAgICAgICAgaWYgQml0c0FuZEJ5dGVzQ29uZmlnIGlzIE5vbmU6CiAgICAgICAgICAgICAgICByYWlzZSBSdW50aW1lRXJyb3IoImJpdHNhbmRieXRlcyBpcyByZXF1aXJlZCBmb3IgSU5UOCBydW5zIikKICAgICAgICAgICAgbW9kZWxfa3dhcmdzWyJxdWFudGl6YXRpb25fY29uZmlnIl0gPSBCaXRzQW5kQnl0ZXNDb25maWcoCiAgICAgICAgICAgICAgICBsb2FkX2luXzhiaXQ9VHJ1ZSwKICAgICAgICAgICAgICAgIGxsbV9pbnQ4X3RocmVzaG9sZD02LjAsCiAgICAgICAgICAgICAgICBsbG1faW50OF9oYXNfZnAxNl93ZWlnaHQ9RmFsc2UsCiAgICAgICAgICAgICAgICBsbG1faW50OF9lbmFibGVfZnAzMl9jcHVfb2ZmbG9hZD1GYWxzZSwKICAgICAgICAgICAgKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoZiJVbnN1cHBvcnRlZCBwcmVjaXNpb246IHtwcmVjaXNpb259IikKCiAgICAgICAgaWYgdG9yY2guY3VkYS5pc19hdmFpbGFibGUoKToKICAgICAgICAgICAgdG9yY2guY3VkYS5lbXB0eV9jYWNoZSgpCiAgICAgICAgICAgIHRvcmNoLmN1ZGEucmVzZXRfcGVha19tZW1vcnlfc3RhdHMoKQoKICAgICAgICBtb2RlbCA9IEF1dG9Nb2RlbEZvckNhdXNhbExNLmZyb21fcHJldHJhaW5lZChtb2RlbF9pZCwgKiptb2RlbF9rd2FyZ3MpCgogICAgICAgIGlucHV0X2lkc19oZiA9IGlucHV0X2lkcy50byhtb2RlbC5kZXZpY2UpCiAgICAgICAgYXR0ZW50aW9uX21hc2tfaGYgPSBhdHRlbnRpb25fbWFzay50byhtb2RlbC5kZXZpY2UpCgogICAgICAgIHN5bmNfY3VkYSgpCiAgICAgICAgc3RhcnQgPSB0aW1lLnBlcmZfY291bnRlcigpCiAgICAgICAgb3V0cHV0cyA9IG1vZGVsLmdlbmVyYXRlKAogICAgICAgICAgICBpbnB1dF9pZHM9aW5wdXRfaWRzX2hmLAogICAgICAgICAgICBhdHRlbnRpb25fbWFzaz1hdHRlbnRpb25fbWFza19oZiwKICAgICAgICAgICAgbWF4X25ld190b2tlbnM9Z2VuX3Rva2VucywKICAgICAgICAgICAgdGVtcGVyYXR1cmU9MC43LAogICAgICAgICAgICB0b3BfcD0wLjksCiAgICAgICAgICAgIGRvX3NhbXBsZT1GYWxzZSwKICAgICAgICApCiAgICAgICAgc3luY19jdWRhKCkKICAgICAgICBlbGFwc2VkID0gdGltZS5wZXJmX2NvdW50ZXIoKSAtIHN0YXJ0CgogICAgICAgIHRvdGFsX3Rva2VucyA9IG91dHB1dHMuc2hhcGVbLTFdCiAgICAgICAgbmV3X3Rva2VucyA9IHRvdGFsX3Rva2VucyAtIHByb21wdF90b2tlbnMKICAgICAgICBleGNlcnB0X3Rva2VucyA9IG91dHB1dHNbMF1bLW1pbihuZXdfdG9rZW5zLCA2NCk6XQogICAgICAgIGV4Y2VycHRfdGV4dCA9IHRva2VuaXplci5kZWNvZGUoZXhjZXJwdF90b2tlbnMsIHNraXBfc3BlY2lhbF90b2tlbnM9VHJ1ZSkuc3RyaXAoKQoKICAgICAgICBkZXZpY2VfbWFwX29iaiA9IGdldGF0dHIobW9kZWwsICJoZl9kZXZpY2VfbWFwIiwgTm9uZSkKICAgICAgICBpZiBpc2luc3RhbmNlKGRldmljZV9tYXBfb2JqLCBkaWN0KToKICAgICAgICAgICAgZGV2aWNlX21hcF9zZXJpYWxpemFibGUgPSB7a2V5OiBzdHIodmFsKSBmb3Iga2V5LCB2YWwgaW4gZGV2aWNlX21hcF9vYmouaXRlbXMoKX0KICAgICAgICBlbHNlOgogICAgICAgICAgICBkZXZpY2VfbWFwX3NlcmlhbGl6YWJsZSA9IE5vbmUKCiAgICAgICAgcGVha19tZW1vcnkgPSBjb2xsZWN0X3BlYWtfbWVtb3J5KCkKICAgICAgICBtYXhfbWVtb3J5X3JlcXVlc3QgPSBtb2RlbF9rd2FyZ3MuZ2V0KCJtYXhfbWVtb3J5IikKCiAgICBlbGlmIGVuZ2luZSA9PSAidmxsbSI6CiAgICAgICAgaWYgcHJlY2lzaW9uLmxvd2VyKCkgIT0gImZwMTYiOgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCJ2TExNIHBhdGggY3VycmVudGx5IHN1cHBvcnRzIEZQMTYgb25seSBpbiB0aGlzIHNjcmlwdCIpCiAgICAgICAgaWYgTExNIGlzIE5vbmUgb3IgU2FtcGxpbmdQYXJhbXMgaXMgTm9uZToKICAgICAgICAgICAgcmFpc2UgUnVudGltZUVycm9yKCJ2bGxtIHBhY2thZ2UgaXMgcmVxdWlyZWQgd2hlbiAtLWVuZ2luZSB2bGxtIikKCiAgICAgICAgbGxtID0gTExNKAogICAgICAgICAgICBtb2RlbD1tb2RlbF9pZCwKICAgICAgICAgICAgdGVuc29yX3BhcmFsbGVsX3NpemU9dGVuc29yX3BhcmFsbGVsX3NpemUsCiAgICAgICAgICAgIGR0eXBlPSJmbG9hdDE2IiwKICAgICAgICAgICAgdHJ1c3RfcmVtb3RlX2NvZGU9VHJ1ZSwKICAgICAgICAgICAgbWF4X21vZGVsX2xlbj1tYXhfbW9kZWxfbGVuLAogICAgICAgICAgICBncHVfbWVtb3J5X3V0aWxpemF0aW9uPWdwdV9tZW1vcnlfdXRpbGl6YXRpb24sCiAgICAgICAgKQoKICAgICAgICBzYW1wbGluZ19wYXJhbXMgPSBTYW1wbGluZ1BhcmFtcygKICAgICAgICAgICAgdGVtcGVyYXR1cmU9MC43LAogICAgICAgICAgICB0b3BfcD0wLjksCiAgICAgICAgICAgIG1heF90b2tlbnM9Z2VuX3Rva2VucywKICAgICAgICApCgogICAgICAgIHByb21wdF90b2tlbl9pZHM6IExpc3RbaW50XSA9IGlucHV0X2lkc1swXS50b2xpc3QoKQogICAgICAgIHByb21wdF90b2tlbl9iYXRjaDogTGlzdFtMaXN0W2ludF1dID0gW3Byb21wdF90b2tlbl9pZHNdCiAgICAgICAgcHJvbXB0X3RleHRfYmF0Y2g6IExpc3Rbc3RyXSA9IFt0b2tlbml6ZXIuZGVjb2RlKGlucHV0X2lkc1swXSwgc2tpcF9zcGVjaWFsX3Rva2Vucz1UcnVlKV0KCiAgICAgICAgc3luY19jdWRhKCkKICAgICAgICBzdGFydCA9IHRpbWUucGVyZl9jb3VudGVyKCkKICAgICAgICB0cnk6CiAgICAgICAgICAgIG91dHB1dHMgPSBsbG0uZ2VuZXJhdGUocHJvbXB0X3Rva2VuX2lkcz1wcm9tcHRfdG9rZW5fYmF0Y2gsIHNhbXBsaW5nX3BhcmFtcz1zYW1wbGluZ19wYXJhbXMpCiAgICAgICAgZXhjZXB0IFR5cGVFcnJvciBhcyBleGM6CiAgICAgICAgICAgIGlmICJwcm9tcHRfdG9rZW5faWRzIiBub3QgaW4gc3RyKGV4Yyk6CiAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBvdXRwdXRzID0gbGxtLmdlbmVyYXRlKHByb21wdHM9cHJvbXB0X3RleHRfYmF0Y2gsIHNhbXBsaW5nX3BhcmFtcz1zYW1wbGluZ19wYXJhbXMpCiAgICAgICAgc3luY19jdWRhKCkKICAgICAgICBlbGFwc2VkID0gdGltZS5wZXJmX2NvdW50ZXIoKSAtIHN0YXJ0CgogICAgICAgIGlmIG5vdCBvdXRwdXRzOgogICAgICAgICAgICByYWlzZSBSdW50aW1lRXJyb3IoInZMTE0gcmV0dXJuZWQgbm8gZ2VuZXJhdGlvbnMiKQoKICAgICAgICBmaXJzdF9vdXRwdXQgPSBvdXRwdXRzWzBdCiAgICAgICAgaWYgbm90IGZpcnN0X291dHB1dC5vdXRwdXRzOgogICAgICAgICAgICByYWlzZSBSdW50aW1lRXJyb3IoInZMTE0gcmVzcG9uc2UgbWlzc2luZyBvdXRwdXQgdG9rZW5zIikKCiAgICAgICAgZ2VuZXJhdGVkID0gZmlyc3Rfb3V0cHV0Lm91dHB1dHNbMF0KICAgICAgICBuZXdfdG9rZW5zID0gbGVuKGdlbmVyYXRlZC50b2tlbl9pZHMpCiAgICAgICAgZXhjZXJwdF90ZXh0ID0gZ2VuZXJhdGVkLnRleHQuc3RyaXAoKQogICAgICAgIGRldmljZV9tYXBfc2VyaWFsaXphYmxlID0gewogICAgICAgICAgICAiZW5naW5lIjogInZsbG0iLAogICAgICAgICAgICAidGVuc29yX3BhcmFsbGVsX3NpemUiOiB0ZW5zb3JfcGFyYWxsZWxfc2l6ZSwKICAgICAgICB9CiAgICAgICAgcGVha19tZW1vcnkgPSBjb2xsZWN0X3BlYWtfbWVtb3J5KCkKICAgICAgICBtYXhfbWVtb3J5X3JlcXVlc3QgPSBOb25lCgogICAgZWxpZiBlbmdpbmUgPT0gImxtZGVwbG95IjoKICAgICAgICBpZiBwcmVjaXNpb24ubG93ZXIoKSAhPSAiZnAxNiI6CiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoIkxNRGVwbG95IFR1cmJvTWluZCBwYXRoIGN1cnJlbnRseSBzdXBwb3J0cyBGUDE2IG9ubHkgaW4gdGhpcyBzY3JpcHQiKQogICAgICAgIGlmIGxtZGVwbG95X3BpcGVsaW5lIGlzIE5vbmUgb3IgVHVyYm9taW5kRW5naW5lQ29uZmlnIGlzIE5vbmU6CiAgICAgICAgICAgIHJhaXNlIFJ1bnRpbWVFcnJvcigibG1kZXBsb3kgcGFja2FnZSBpcyByZXF1aXJlZCB3aGVuIC0tZW5naW5lIGxtZGVwbG95IikKICAgICAgICBpZiBub3QgbG1kZXBsb3lfbW9kZWxfcGF0aDoKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigiLS1sbWRlcGxveS1tb2RlbC1wYXRoIGlzIHJlcXVpcmVkIHdoZW4gLS1lbmdpbmUgbG1kZXBsb3kiKQoKICAgICAgICBzZXNzaW9uX2xlbiA9IG1heF9tb2RlbF9sZW4gb3IgKHByb21wdF90b2tlbnMgKyBnZW5fdG9rZW5zICsgMTAyNCkKICAgICAgICBjYWNoZV9yYXRpbyA9IG1heCgwLjEsIG1pbihncHVfbWVtb3J5X3V0aWxpemF0aW9uLCAwLjk1KSkKICAgICAgICBiYWNrZW5kX2NvbmZpZyA9IFR1cmJvbWluZEVuZ2luZUNvbmZpZygKICAgICAgICAgICAgdHA9dGVuc29yX3BhcmFsbGVsX3NpemUsCiAgICAgICAgICAgIHNlc3Npb25fbGVuPXNlc3Npb25fbGVuLAogICAgICAgICAgICBjYWNoZV9tYXhfZW50cnlfY291bnQ9Y2FjaGVfcmF0aW8sCiAgICAgICAgICAgIG1heF9iYXRjaF9zaXplPTEsCiAgICAgICAgKQoKICAgICAgICBpZiB0b3JjaC5jdWRhLmlzX2F2YWlsYWJsZSgpOgogICAgICAgICAgICB0b3JjaC5jdWRhLmVtcHR5X2NhY2hlKCkKICAgICAgICAgICAgdG9yY2guY3VkYS5yZXNldF9wZWFrX21lbW9yeV9zdGF0cygpCgogICAgICAgIHBpcGUgPSBsbWRlcGxveV9waXBlbGluZSgKICAgICAgICAgICAgbG1kZXBsb3lfbW9kZWxfcGF0aCwKICAgICAgICAgICAgYmFja2VuZF9jb25maWc9YmFja2VuZF9jb25maWcsCiAgICAgICAgKQoKICAgICAgICBwcm9tcHRfdGV4dCA9IHRva2VuaXplci5kZWNvZGUoaW5wdXRfaWRzWzBdLCBza2lwX3NwZWNpYWxfdG9rZW5zPVRydWUpCgogICAgICAgIHN5bmNfY3VkYSgpCiAgICAgICAgc3RhcnQgPSB0aW1lLnBlcmZfY291bnRlcigpCiAgICAgICAgcmVzcG9uc2VzID0gcGlwZSgKICAgICAgICAgICAgW3Byb21wdF90ZXh0XSwKICAgICAgICAgICAgbWF4X25ld190b2tlbnM9Z2VuX3Rva2VucywKICAgICAgICAgICAgdGVtcGVyYXR1cmU9MC43LAogICAgICAgICAgICB0b3BfcD0wLjksCiAgICAgICAgKQogICAgICAgIHN5bmNfY3VkYSgpCiAgICAgICAgZWxhcHNlZCA9IHRpbWUucGVyZl9jb3VudGVyKCkgLSBzdGFydAoKICAgICAgICBpZiBub3QgcmVzcG9uc2VzOgogICAgICAgICAgICByYWlzZSBSdW50aW1lRXJyb3IoIkxNRGVwbG95IHBpcGVsaW5lIHJldHVybmVkIG5vIHJlc3BvbnNlcyIpCiAgICAgICAgZmlyc3RfcmVzcG9uc2UgPSByZXNwb25zZXNbMF0KICAgICAgICBuZXdfdG9rZW5zID0gZ2V0YXR0cihmaXJzdF9yZXNwb25zZSwgImdlbmVyYXRlX3Rva2VuX2xlbiIsIDApCiAgICAgICAgaWYgbm90IG5ld190b2tlbnMgYW5kIGdldGF0dHIoZmlyc3RfcmVzcG9uc2UsICJ0b2tlbl9pZHMiLCBOb25lKToKICAgICAgICAgICAgbmV3X3Rva2VucyA9IGxlbihmaXJzdF9yZXNwb25zZS50b2tlbl9pZHMpCiAgICAgICAgaWYgbm90IG5ld190b2tlbnM6CiAgICAgICAgICAgIHJhaXNlIFJ1bnRpbWVFcnJvcigiTE1EZXBsb3kgcmVzcG9uc2UgbWlzc2luZyB0b2tlbiBzdGF0aXN0aWNzIikKICAgICAgICBleGNlcnB0X3RleHQgPSBzdHIoZ2V0YXR0cihmaXJzdF9yZXNwb25zZSwgInRleHQiLCAiIikpLnN0cmlwKCkKICAgICAgICBkZXZpY2VfbWFwX3NlcmlhbGl6YWJsZSA9IHsKICAgICAgICAgICAgImVuZ2luZSI6ICJsbWRlcGxveS10dXJib21pbmQiLAogICAgICAgICAgICAidGVuc29yX3BhcmFsbGVsX3NpemUiOiB0ZW5zb3JfcGFyYWxsZWxfc2l6ZSwKICAgICAgICAgICAgInNlc3Npb25fbGVuIjogc2Vzc2lvbl9sZW4sCiAgICAgICAgfQogICAgICAgIHBlYWtfbWVtb3J5ID0gY29sbGVjdF9wZWFrX21lbW9yeSgpCiAgICAgICAgbWF4X21lbW9yeV9yZXF1ZXN0ID0gTm9uZQoKICAgIGVsc2U6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihmIlVuc3VwcG9ydGVkIGVuZ2luZToge2VuZ2luZX0iKQoKICAgIHJlc3VsdDogRGljdFtzdHIsIG9iamVjdF0gPSB7CiAgICAgICAgIm1vZGVsIjogbW9kZWxfaWQsCiAgICAgICAgInByZWNpc2lvbiI6IHByZWNpc2lvbiwKICAgICAgICAicHJvbXB0X3Rva2VucyI6IHByb21wdF90b2tlbnMsCiAgICAgICAgImdlbmVyYXRlZF90b2tlbnMiOiBuZXdfdG9rZW5zLAogICAgICAgICJyZXF1ZXN0ZWRfZ2VuZXJhdGVkX3Rva2VucyI6IGdlbl90b2tlbnMsCiAgICAgICAgIndhbGxfdGltZV9zZWNvbmRzIjogZWxhcHNlZCwKICAgICAgICAidG9rZW5zX3Blcl9zZWNvbmQiOiBuZXdfdG9rZW5zIC8gZWxhcHNlZCBpZiBlbGFwc2VkID4gMCBlbHNlIGZsb2F0KCJpbmYiKSwKICAgICAgICAiZXhjZXJwdCI6IGV4Y2VycHRfdGV4dCwKICAgICAgICAiZGV2aWNlX21hcCI6IGRldmljZV9tYXBfc2VyaWFsaXphYmxlLAogICAgICAgICJwZWFrX21lbW9yeV9naWIiOiBwZWFrX21lbW9yeSwKICAgICAgICAibWF4X21lbW9yeV9yZXF1ZXN0IjogbWF4X21lbW9yeV9yZXF1ZXN0LAogICAgICAgICJvZmZsb2FkX2ZvbGRlciI6IG9mZmxvYWRfZm9sZGVyLAogICAgICAgICJvZmZsb2FkX3N0YXRlX2RpY3QiOiBvZmZsb2FkX3N0YXRlX2RpY3QsCiAgICAgICAgIm9mZmxvYWRfYnVmZmVycyI6IG9mZmxvYWRfYnVmZmVycywKICAgICAgICAibG93X2NwdV9tZW1fdXNhZ2UiOiBsb3dfY3B1X21lbV91c2FnZSwKICAgICAgICAiZW5naW5lIjogZW5naW5lLAogICAgICAgICJ0ZW5zb3JfcGFyYWxsZWxfc2l6ZSI6IHRlbnNvcl9wYXJhbGxlbF9zaXplLAogICAgICAgICJhdHRuX2ltcGxlbWVudGF0aW9uIjogYXR0bl9pbXBsLAogICAgICAgICJtYXhfbW9kZWxfbGVuIjogbWF4X21vZGVsX2xlbiwKICAgICAgICAiZ3B1X21lbW9yeV91dGlsaXphdGlvbiI6IGdwdV9tZW1vcnlfdXRpbGl6YXRpb24sCiAgICAgICAgImxtZGVwbG95X21vZGVsX3BhdGgiOiBsbWRlcGxveV9tb2RlbF9wYXRoLAogICAgfQogICAgcmV0dXJuIHJlc3VsdAoKCmRlZiBtYWluKCkgLT4gTm9uZToKICAgIHBhcnNlciA9IGFyZ3BhcnNlLkFyZ3VtZW50UGFyc2VyKGRlc2NyaXB0aW9uPSJSdW4gUXdlbiBiZW5jaG1hcmsgZm9yIGFyYml0cmFyeSBtb2RlbCIpCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KCItLW1vZGVsIiwgcmVxdWlyZWQ9VHJ1ZSwgaGVscD0iTW9kZWwgSUQsIGUuZy4sIFF3ZW4vUXdlbjIuNS0zMkItSW5zdHJ1Y3QiKQogICAgcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1wcmVjaXNpb24iLCBjaG9pY2VzPVsiRlAxNiIsICJJTlQ4Il0sIHJlcXVpcmVkPVRydWUpCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KCItLXByb21wdC10b2tlbnMiLCB0eXBlPWludCwgZGVmYXVsdD0xMF8wMDApCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KCItLWdlbmVyYXRlZC10b2tlbnMiLCB0eXBlPWludCwgZGVmYXVsdD04MDApCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KCItLWRldmljZS1tYXAiLCBkZWZhdWx0PSJhdXRvIiwgaGVscD0iZGV2aWNlX21hcCBwYXNzZWQgdG8gZnJvbV9wcmV0cmFpbmVkIChIRiBlbmdpbmUpIikKICAgIHBhcnNlci5hZGRfYXJndW1lbnQoIi0tbWF4LW1lbW9yeS1naWIiLCB0eXBlPWZsb2F0LCBoZWxwPSJPcHRpb25hbCBwZXItR1BVIG1lbW9yeSBjYXAgcGFzc2VkIHRvIGZyb21fcHJldHJhaW5lZCIpCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KCItLW9mZmxvYWQtZm9sZGVyIiwgaGVscD0iT3B0aW9uYWwgb2ZmbG9hZCBmb2xkZXIgcGF0aCAoZS5nLiwgTlZNZSBtb3VudCkiKQogICAgcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1vZmZsb2FkLXN0YXRlLWRpY3QiLCBhY3Rpb249InN0b3JlX3RydWUiLCBoZWxwPSJFbmFibGUgc3RhdGUgZGljdCBvZmZsb2FkIHRvIENQVS9kaXNrIikKICAgIHBhcnNlci5hZGRfYXJndW1lbnQoIi0tb2ZmbG9hZC1idWZmZXJzIiwgYWN0aW9uPSJzdG9yZV90cnVlIiwgaGVscD0iRW5hYmxlIGJ1ZmZlciBvZmZsb2FkIHRvIENQVS9kaXNrIikKICAgIHBhcnNlci5hZGRfYXJndW1lbnQoIi0tbG93LWNwdS1tZW0tdXNhZ2UiLCBhY3Rpb249InN0b3JlX3RydWUiLCBoZWxwPSJBY3RpdmF0ZSBsb3dfY3B1X21lbV91c2FnZSBmbGFnIikKICAgIHBhcnNlci5hZGRfYXJndW1lbnQoCiAgICAgICAgIi0tZW5naW5lIiwKICAgICAgICBjaG9pY2VzPVsiaGYiLCAidmxsbSIsICJsbWRlcGxveSJdLAogICAgICAgIGRlZmF1bHQ9ImhmIiwKICAgICAgICBoZWxwPSJSdW50aW1lIGVuZ2luZTogSHVnZ2luZ0ZhY2UsIHZMTE0sIG9yIExNRGVwbG95IFR1cmJvTWluZCIsCiAgICApCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KCItLXRlbnNvci1wYXJhbGxlbC1zaXplIiwgdHlwZT1pbnQsIGRlZmF1bHQ9MSwgaGVscD0iVGVuc29yIHBhcmFsbGVsIGRlZ3JlZSBmb3IgdkxMTSIpCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KAogICAgICAgICItLWF0dG4taW1wbCIsCiAgICAgICAgY2hvaWNlcz1bImF1dG8iLCAiZWFnZXIiLCAiZmxhc2hfYXR0ZW50aW9uXzIiXSwKICAgICAgICBkZWZhdWx0PSJhdXRvIiwKICAgICAgICBoZWxwPSJBdHRlbnRpb24gaW1wbGVtZW50YXRpb24gaGludCBmb3IgSEYgZW5naW5lIiwKICAgICkKICAgIHBhcnNlci5hZGRfYXJndW1lbnQoIi0tbWF4LW1vZGVsLWxlbiIsIHR5cGU9aW50LCBoZWxwPSJPdmVycmlkZSBtYXggbW9kZWwgbGVuZ3RoIHdoZW4gdXNpbmcgdkxMTSIpCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KAogICAgICAgICItLWdwdS1tZW1vcnktdXRpbGl6YXRpb24iLAogICAgICAgIHR5cGU9ZmxvYXQsCiAgICAgICAgZGVmYXVsdD0wLjk1LAogICAgICAgIGhlbHA9IkZyYWN0aW9uIG9mIFZSQU0gdXNlZCBmb3IgS1YgY2FjaGUgKHZMTE0pIG9yIExNRGVwbG95IGNhY2hlIGJ1ZGdldCIsCiAgICApCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KCItLWxtZGVwbG95LW1vZGVsLXBhdGgiLCBoZWxwPSJQYXRoIHRvIExNRGVwbG95IFR1cmJvTWluZCB3b3Jrc3BhY2Ugd2hlbiAtLWVuZ2luZSBsbWRlcGxveSIpCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KCItLW91dHB1dC1qc29uIiwgaGVscD0iT3B0aW9uYWwgcGF0aCB0byB3cml0ZSBKU09OIHJlc3VsdCIpCiAgICBhcmdzID0gcGFyc2VyLnBhcnNlX2FyZ3MoKQoKICAgIHRyeToKICAgICAgICByZXN1bHQgPSBydW5fYmVuY2htYXJrKAogICAgICAgICAgICBtb2RlbF9pZD1hcmdzLm1vZGVsLAogICAgICAgICAgICBwcmVjaXNpb249YXJncy5wcmVjaXNpb24sCiAgICAgICAgICAgIHByb21wdF90b2tlbnM9YXJncy5wcm9tcHRfdG9rZW5zLAogICAgICAgICAgICBnZW5fdG9rZW5zPWFyZ3MuZ2VuZXJhdGVkX3Rva2VucywKICAgICAgICAgICAgZGV2aWNlX21hcD1hcmdzLmRldmljZV9tYXAsCiAgICAgICAgICAgIG1heF9tZW1vcnlfZ2liPWFyZ3MubWF4X21lbW9yeV9naWIsCiAgICAgICAgICAgIG9mZmxvYWRfZm9sZGVyPWFyZ3Mub2ZmbG9hZF9mb2xkZXIsCiAgICAgICAgICAgIG9mZmxvYWRfc3RhdGVfZGljdD1hcmdzLm9mZmxvYWRfc3RhdGVfZGljdCwKICAgICAgICAgICAgb2ZmbG9hZF9idWZmZXJzPWFyZ3Mub2ZmbG9hZF9idWZmZXJzLAogICAgICAgICAgICBsb3dfY3B1X21lbV91c2FnZT1hcmdzLmxvd19jcHVfbWVtX3VzYWdlLAogICAgICAgICAgICBlbmdpbmU9YXJncy5lbmdpbmUsCiAgICAgICAgICAgIHRlbnNvcl9wYXJhbGxlbF9zaXplPWFyZ3MudGVuc29yX3BhcmFsbGVsX3NpemUsCiAgICAgICAgICAgIGF0dG5faW1wbD1hcmdzLmF0dG5faW1wbCwKICAgICAgICAgICAgbWF4X21vZGVsX2xlbj1hcmdzLm1heF9tb2RlbF9sZW4sCiAgICAgICAgICAgIGdwdV9tZW1vcnlfdXRpbGl6YXRpb249YXJncy5ncHVfbWVtb3J5X3V0aWxpemF0aW9uLAogICAgICAgICAgICBsbWRlcGxveV9tb2RlbF9wYXRoPWFyZ3MubG1kZXBsb3lfbW9kZWxfcGF0aCwKICAgICAgICApCiAgICAgICAgcGF5bG9hZCA9IGpzb24uZHVtcHMocmVzdWx0LCBlbnN1cmVfYXNjaWk9RmFsc2UsIGluZGVudD0yKQogICAgICAgIHByaW50KHBheWxvYWQpCiAgICAgICAgaWYgYXJncy5vdXRwdXRfanNvbjoKICAgICAgICAgICAgd2l0aCBvcGVuKGFyZ3Mub3V0cHV0X2pzb24sICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZnA6CiAgICAgICAgICAgICAgICBmcC53cml0ZShwYXlsb2FkICsgIlxuIikKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZXhjOiAgIyBzdXJmYWNlIGZhaWx1cmUgY29udGV4dAogICAgICAgIGVycm9yID0gewogICAgICAgICAgICAibW9kZWwiOiBhcmdzLm1vZGVsLAogICAgICAgICAgICAicHJlY2lzaW9uIjogYXJncy5wcmVjaXNpb24sCiAgICAgICAgICAgICJlcnJvciI6IHN0cihleGMpLAogICAgICAgIH0KICAgICAgICBwYXlsb2FkID0ganNvbi5kdW1wcyhlcnJvciwgZW5zdXJlX2FzY2lpPUZhbHNlLCBpbmRlbnQ9MikKICAgICAgICBwcmludChwYXlsb2FkKQogICAgICAgIGlmIGFyZ3Mub3V0cHV0X2pzb246CiAgICAgICAgICAgIHdpdGggb3BlbihhcmdzLm91dHB1dF9qc29uLCAidyIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGZwOgogICAgICAgICAgICAgICAgZnAud3JpdGUocGF5bG9hZCArICJcbiIpCiAgICAgICAgcmFpc2UKCgppZiBfX25hbWVfXyA9PSAiX19tYWluX18iOgogICAgbWFpbigpCg=='''
pathlib.Path('/home/azureuser/qwen/qwen_multi_benchmark.py').write_bytes(base64.b64decode(DATA))
EOF
